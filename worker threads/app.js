/**Теория:
 * Worker Threads работает при:
 * - Файловых операциях
 * - dns.lookup
 * - pipes(некоторые случаи)
 * - cpu intense tasks
 * Системные асинхронные вызовы  на уровне ядра:
 * - TCP/UDP сервер и клиет
 * - pipes
 * - dns resolve
 * - Child Process
 */

const crypto = require("crypto");
const start = performance.now();

process.env.UV_THREADPOOL_SIZE = 3;

for (let i = 0; i < 50; i++) {
  crypto.pbkdf2("test", "salt", 1000000, 64, "sha512", () => {
    console.log(performance.now() - start);
  });
}

/**
 * 974.5602950006723
 * 1189.3935150057077
 * 1189.7492910027504
 * 1189.871080994606
 * 2046.0290170013905
 * 2132.0244510024786
 * 2215.543647006154
 * 2225.563092008233
 * 3088.587393000722
 * 3089.339734002948
 * 3252.7465900033712
 * 3319.8260059952736
 * 4042.4575330018997
 * 4242.58010700345
 * 4261.244414001703
 * 4331.918522000313
 * 5050.465376004577
 * 5423.629069000483
 * 5434.231719002128
 * 5656.447638005018
 * 6034.783696994185
 * 6511.359773993492
 * 6553.265411004424
 * 6798.860223993659
 * 7034.351328000426
 * 7492.862470000982
 * 7496.277165994048
 * 7947.20858900249
 * 8241.570062994957
 * 8447.097402006388
 * 8550.833249002695
 * 9012.235250994563
 * 9271.647633001208
 * 9422.637759000063
 * 9632.172368004918
 * 10189.57464800775
 * 10281.309076994658
 * 10415.703896000981
 * 10622.63165999949
 * 11219.130611002445
 * 11254.38461600244
 * 11473.686139002442
 * 11668.095498993993
 * 12163.186128005385
 * 12297.708353996277
 * 12506.3270740062
 * 12656.895787999034
 * 13096.481622993946
 * 13371.977601006627
 * 13492.175431996584
 */

//? они выполнились все +- по 4 за тик, т.к. у проца 4 ядра,
//? но мы можем менять число ядре воркертреда

/**после добавления строки с UV_THREADPOOL_SIZE = 2
 * 956.7305389940739
 * 962.6195089966059
 * 1908.8581289947033
 * 1936.9996639937162
 * 2863.999028995633
 * 2902.4824810028076
 * 3818.7129050046206
 * 3863.329155996442
 * 4768.673271998763
 * 4824.334692001343
 * 5712.691191002727
 * 5776.17950899899
 * 6670.00256100297
 * 6744.672235995531
 * 7634.103365004063
 * 7715.971285998821
 * 8586.015100002289
 * 8677.764321997762
 * 9535.707878991961
 * 9636.094465002418
 * 10467.340048998594
 * 10571.753593996167
 * 11418.136741995811
 * 11541.659120991826
 * 12380.673252001405
 * 12502.109768003225
 * 13357.49351799488
 * 13479.480351999402
 * 14385.078566998243
 * 14456.777070000768
 * 15413.615309998393
 * 15421.201790004969
 * 16381.178554996848
 * 16387.950021997094
 * 17349.531267002225
 * 17354.812989994884
 * 18310.404633000493
 * 18342.882799997926
 * 19284.829233005643
 * 19307.529370993376
 * 20257.38357499242
 * 20278.526037991047
 * 21219.65237799287
 * 21239.605634003878
 * 22194.10229000449
 * 22198.736517995596
 * 23178.317497998476
 * 23178.54606999457
 * 24150.742277994752
 * 24160.978156998754
 */

const https = require("https");
const { resolve } = require("node:path/win32");

for (let i = 0; i < 50; i++) {
  https.get("https://yandex.ru", (res) => {
    res.on("data", () => {});
    res.on("end", () => {
      console.log(performance.now());
    });
  });
}

/**network обращения работают не в воркер треде и это видно по времени
 * 246.81798699498177
 * 249.5473670065403
 * 249.88933600485325
 * 250.33498999476433
 * 279.0582050085068
 * 280.60022300481796
 * 282.1519750058651
 * 283.93727900087833
 * 286.22182600200176
 * 287.9694340080023
 * 289.50140799582005
 * 307.1513410061598
 * 309.54150199890137
 * 337.10386599600315
 * 342.3744879961014
 * 343.1471669971943
 * 368.3028309941292
 * 406.66598300635815
 * 407.27283599972725
 * 584.7085539996624
 * 588.448038995266
 * 624.252110004425
 * 626.6645260006189
 * 637.8787170052528
 * 698.1498010009527
 * 699.7458360046148
 * 739.5046710073948
 * 740.039930999279
 * 841.4384299963713
 * 855.3745680004358
 * 925.3719329982996
 * 926.6247989982367
 * 934.5867920070887
 * 937.9524759948254
 * 960.1054629981518
 * 971.0044900029898
 * 972.3063910007477
 * 975.5611059963703
 * 994.7103700041771
 * 1007.6768440008163
 * 1009.9374590069056
 * 1011.8453209996223
 * 1056.3186749964952
 * 1064.4110209941864
 * 1077.45505400002
 * 1078.8125949949026
 * 1093.1420039981604
 * 1107.3360760062933
 * 1112.7510769963264
 * 1121.2588690072298
 */